generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Auth {
  id            String        @id @default(dbgenerated("(gen_random_uuid())::text"))
  email         String?       @unique
  phone         String?       @unique
  googleId      String?       @unique @map("google_id")
  emailVerified Boolean       @default(false) @map("email_verified")
  phoneVerified Boolean       @default(false) @map("phone_verified")
  isActive      Boolean       @default(true) @map("is_active")
  isBlocked     Boolean       @default(false) @map("is_blocked")
  blockedReason String?       @map("blocked_reason")
  blockedAt     DateTime?     @map("blocked_at")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")
  lastLogin     DateTime?     @map("last_login")
  sessions      AuthSession[]
  user          User?         @relation("AuthToUser")

  @@map("auth")
}

model AuthSession {
  id               String   @id @default(dbgenerated("(gen_random_uuid())::text"))
  refreshTokenHash String   @unique @map("refresh_token_hash")
  deviceInfo       Json?    @map("device_info")
  ipAddress        String?  @map("ip_address") @db.Inet
  userAgent        String?  @map("user_agent")
  expiresAt        DateTime @map("expires_at")
  createdAt        DateTime @default(now()) @map("created_at")
  revoked          Boolean  @default(false)
  authId           String   @map("auth_id")
  lastUsedAt       DateTime @default(now()) @map("last_used_at")
  auth             Auth     @relation(fields: [authId], references: [id], onDelete: Cascade)

  @@index([authId])
  @@index([expiresAt])
  @@index([authId, expiresAt, revoked], map: "auth_sessions_active_idx")
  @@index([ipAddress])
  @@index([refreshTokenHash, expiresAt, revoked], map: "auth_sessions_validation_idx")
  @@map("auth_sessions")
}

model User {
  id                  String    @id @default(dbgenerated("(gen_random_uuid())::text"))
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  authId              String    @unique @map("auth_id")
  firstName           String?   @map("first_name") @db.VarChar(100)
  lastName            String?   @map("last_name") @db.VarChar(100)
  displayName         String?   @map("display_name") @db.VarChar(150)
  avatarUrl           String?   @map("avatar_url")
  addressLine1        String?   @map("address_line1") @db.VarChar(255)
  addressLine2        String?   @map("address_line2") @db.VarChar(255)
  city                String?   @db.VarChar(100)
  state               String?   @db.VarChar(100)
  postalCode          String?   @map("postal_code") @db.VarChar(20)
  country             String?   @db.VarChar(100)
  dateOfBirth         DateTime? @map("date_of_birth") @db.Date
  preferences         Json      @default("{}")
  onboardingCompleted Boolean   @default(false) @map("onboarding_completed")
  profileCompletedAt  DateTime? @map("profile_completed_at")
  auth                Auth      @relation("AuthToUser", fields: [authId], references: [id], onDelete: Cascade)

  @@index([firstName, lastName], map: "users_full_name_idx")
  @@index([onboardingCompleted], map: "users_onboarding_idx")
  @@index([createdAt(sort: Desc)])
  @@map("users")
}

model Product {
  id                String           @id @default(dbgenerated("(gen_random_uuid())::text"))
  name              String           @db.VarChar(255)
  slug              String           @unique @db.VarChar(255)
  brand             String           @default("Swaadly") @db.VarChar(100)
  shortDescription  String?          @map("short_description")
  longDescription   String?          @map("long_description")
  productType       String?          @map("product_type") @db.VarChar(50)
  tags              String[]         @default([])
  proteinPer100g    Decimal?         @map("protein_per_100g") @db.Decimal(5, 2)
  caloriesPer100g   Int?             @map("calories_per_100g")
  nutritionalInfo   Json?            @map("nutritional_info")
  features          Json?
  usageInstructions String?          @map("usage_instructions")
  isActive          Boolean          @default(true) @map("is_active")
  isFeatured        Boolean          @default(false) @map("is_featured")
  totalSales        Int              @default(0) @map("total_sales")
  totalReviews      Int              @default(0) @map("total_reviews")
  averageRating     Decimal          @default(0.00) @map("average_rating") @db.Decimal(3, 2)
  viewCount         Int              @default(0) @map("view_count")
  displayOrder      Int              @default(0) @map("display_order")
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")
  images            ProductImage[]
  variants          ProductVariant[]

  @@index([isActive])
  @@index([isFeatured])
  @@index([averageRating(sort: Desc)])
  @@index([totalSales(sort: Desc)])
  @@index([tags], type: Gin)
  @@index([productType])
  @@index([displayOrder])
  @@map("products")
}

model ProductVariant {
  id                 String   @id @default(dbgenerated("(gen_random_uuid())::text"))
  productId          String   @map("product_id")
  sku                String   @unique @db.VarChar(100)
  barcode            String?  @db.VarChar(100)
  weight             Int
  weightUnit         String   @default("g") @map("weight_unit") @db.VarChar(10)
  mrp                Decimal  @db.Decimal(10, 2)
  sellingPrice       Decimal  @map("selling_price") @db.Decimal(10, 2)
  discountPercentage Decimal  @default(0.00) @map("discount_percentage") @db.Decimal(5, 2)
  couponCode         String?  @map("coupon_code") @db.VarChar(50)
  couponAppliedPrice Decimal? @map("coupon_applied_price") @db.Decimal(10, 2)
  stockQuantity      Int      @default(0) @map("stock_quantity")
  lowStockThreshold  Int      @default(10) @map("low_stock_threshold")
  isAvailable        Boolean  @default(true) @map("is_available")
  isDefault          Boolean  @default(false) @map("is_default")
  displayOrder       Int      @default(0) @map("display_order")
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")
  product            Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([isAvailable])
  @@index([stockQuantity], map: "product_variants_stock_idx")
  @@index([productId, isDefault], map: "product_variants_is_default_idx")
  @@map("product_variants")
}

model ProductImage {
  id           String   @id @default(dbgenerated("(gen_random_uuid())::text"))
  productId    String   @map("product_id")
  imageUrl     String   @map("image_url")
  thumbnailUrl String?  @map("thumbnail_url")
  altText      String?  @map("alt_text") @db.VarChar(255)
  displayOrder Int      @default(0) @map("display_order")
  isPrimary    Boolean  @default(false) @map("is_primary")
  createdAt    DateTime @default(now()) @map("created_at")
  product      Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([productId, isPrimary], map: "product_images_is_primary_idx")
  @@index([productId, displayOrder], map: "product_images_display_order_idx")
  @@map("product_images")
}
